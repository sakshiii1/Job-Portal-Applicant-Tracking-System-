<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recruiter dashboard Â· TalentTrack ATS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- âœ… Only correct CSS - your existing files -->
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="../css/dashboard.css">
  
  <!-- Font Awesome for icons (optional - agar nahi hai to add karo) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body data-require-auth="true" data-role="RECRUITER">

  <div class="dash-shell">
    <div class="dash-inner">

      <header class="dash-header">
        <div>
          <div class="dash-title">
            <i class="fas fa-briefcase"></i> Recruiter workspace
          </div>
          <div class="dash-subtitle" id="recruiterGreeting">
            Post roles, review applicants, and move candidates forward.
          </div>
        </div>

        <div class="dash-actions">
          <button type="button" class="dash-button"
            onclick="window.location.href='../index.html'">
            <i class="fas fa-home"></i> Home
          </button>

          <button type="button" class="dash-button primary"
            onclick="Auth.logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </header>

      <!-- Stats Row - using existing dash-card style -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
        <div class="dash-card" style="padding: 15px;">
          <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Active Jobs</div>
          <div style="font-size: 28px; font-weight: 700; color: #4facfe;" id="totalJobsStat">0</div>
        </div>
        <div class="dash-card" style="padding: 15px;">
          <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Total Applicants</div>
          <div style="font-size: 28px; font-weight: 700; color: #4facfe;" id="totalApplicantsStat">0</div>
        </div>
        <div class="dash-card" style="padding: 15px;">
          <div style="font-size: 12px; color: rgba(255,255,255,0.5);">Pending Review</div>
          <div style="font-size: 28px; font-weight: 700; color: #4facfe;" id="pendingReviewStat">0</div>
        </div>
      </div>

      <section class="dash-grid">

        <!-- My Job Posts -->
        <article class="dash-card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 class="dash-card-title">
              <i class="fas fa-bullhorn"></i> My job posts
            </h2>
            <span class="badge" style="background: rgba(79,172,254,0.1); color: #4facfe; padding: 4px 10px; border-radius: 999px; font-size: 12px;" id="jobsCount">0</span>
          </div>
          
          <div class="dash-card-body" id="recruiterJobs">
            <div style="text-align: center; padding: 30px; color: rgba(255,255,255,0.3);">
              <i class="fas fa-briefcase" style="font-size: 40px; margin-bottom: 15px;"></i>
              <p>Your open roles will appear here</p>
              <button onclick="createNewJob()" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: #1a1a2e; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 10px; cursor: pointer;">
                <i class="fas fa-plus"></i> Post New Role
              </button>
            </div>
          </div>
        </article>

        <!-- Incoming Applications -->
        <article class="dash-card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 class="dash-card-title">
              <i class="fas fa-users"></i> Incoming applications
            </h2>
            <span class="badge" style="background: rgba(79,172,254,0.1); color: #4facfe; padding: 4px 10px; border-radius: 999px; font-size: 12px;" id="applicationsCount">0</span>
          </div>
          
          <div class="dash-card-body" id="recruiterApplications">
            <div style="text-align: center; padding: 30px; color: rgba(255,255,255,0.3);">
              <i class="fas fa-inbox" style="font-size: 40px; margin-bottom: 15px;"></i>
              <p>No new applications yet</p>
            </div>
          </div>
        </article>

      </section>

    </div>
  </div>

  <!-- âœ… Correct JS paths -->
  <script src="../js/api.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/job.js"></script>
  <script src="../js/user.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      console.log("ðŸš€ Recruiter dashboard loading...");

      // Check auth
      var token = api.getToken();
      var role = api.getRole();
      
      if (!token || role !== 'RECRUITER') {
        window.location.href = 'loginPage.html';
        return;
      }

      var greetingEl = document.getElementById("recruiterGreeting");
      var jobsEl = document.getElementById("recruiterJobs");
      var applicationsEl = document.getElementById("recruiterApplications");

      // Load current user for greeting
      if (typeof UserApi !== "undefined" && UserApi.me) {
        UserApi.me()
          .then(function (user) {
            if (greetingEl && user) {
              var name = user.fullName || user.name || user.email || "Recruiter";
              greetingEl.innerHTML = `Hi ${name}, here is your recruiter workspace.`;
            }
          })
          .catch(function() {});
      }

      // Load jobs
      if (typeof JobApi !== "undefined" && JobApi.mine) {
        JobApi.mine()
          .then(function (jobs) {
            if (!jobsEl) return;

            // Update stats
            document.getElementById('totalJobsStat').textContent = jobs.length;
            document.getElementById('jobsCount').textContent = jobs.length;

            if (!jobs || jobs.length === 0) {
              jobsEl.innerHTML = `
                <div style="text-align: center; padding: 30px; color: rgba(255,255,255,0.3);">
                  <i class="fas fa-briefcase" style="font-size: 40px; margin-bottom: 15px;"></i>
                  <p>You have not posted any roles yet.</p>
                  <button onclick="createNewJob()" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: #1a1a2e; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 10px; cursor: pointer;">
                    <i class="fas fa-plus"></i> Post Your First Role
                  </button>
                </div>
              `;
              return;
            }

            var container = document.createElement("div");

            jobs.forEach(function (job) {
              var item = document.createElement("div");
              item.style.cssText = 'padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.03); border-radius: 8px; border-left: 3px solid #4facfe;';
              
              var title = job.title || job.jobTitle || "Untitled Role";
              var applicants = job.applicants || 0;
              
              item.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <strong>${title}</strong>
                  <span style="color: #4facfe;">${applicants} applicants</span>
                </div>
                <div style="display: flex; gap: 10px; font-size: 12px; color: rgba(255,255,255,0.5);">
                  <span><i class="fas fa-map-marker-alt"></i> ${job.location || 'Remote'}</span>
                  <span><i class="fas fa-calendar"></i> ${job.postedDate || 'Recently'}</span>
                </div>
              `;
              
              container.appendChild(item);
            });

            jobsEl.innerHTML = "";
            jobsEl.appendChild(container);
          })
          .catch(function(err) {
            console.error("Error loading jobs:", err);
            if (jobsEl) {
              jobsEl.innerHTML = '<div style="color: #ef4444; padding: 20px;">Failed to load jobs.</div>';
            }
          });
      }

      // Load applications
      if (typeof ApplicationApi !== "undefined" && ApplicationApi.forRecruiter) {
        ApplicationApi.forRecruiter()
          .then(function(applications) {
            if (!applicationsEl) return;
            
            document.getElementById('applicationsCount').textContent = applications.length;
            document.getElementById('totalApplicantsStat').textContent = applications.length;
            document.getElementById('pendingReviewStat').textContent = applications.filter(a => a.status === 'NEW').length;

            if (!applications || applications.length === 0) {
              applicationsEl.innerHTML = '<div style="text-align: center; padding: 30px; color: rgba(255,255,255,0.3);"><i class="fas fa-inbox" style="font-size: 40px; margin-bottom: 15px;"></i><p>No applications yet</p></div>';
              return;
            }

            var container = document.createElement("div");

            applications.forEach(function(app) {
              var item = document.createElement("div");
              item.style.cssText = 'display: flex; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05);';
              
              item.innerHTML = `
                <div style="width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, #4facfe, #00f2fe); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                  ${(app.candidateName || 'U').charAt(0)}
                </div>
                <div style="flex: 1;">
                  <div style="font-weight: 500;">${app.candidateName || 'Unknown'}</div>
                  <div style="font-size: 11px; color: rgba(255,255,255,0.5);">${app.jobTitle || 'Position'} Â· ${app.appliedDate || 'Today'}</div>
                </div>
                <span style="padding: 4px 8px; border-radius: 999px; font-size: 10px; background: rgba(79,172,254,0.1); color: #4facfe;">${app.status || 'NEW'}</span>
              `;
              
              container.appendChild(item);
            });

            applicationsEl.innerHTML = "";
            applicationsEl.appendChild(container);
          })
          .catch(function() {
            // If API doesn't exist, show mock data
            showMockApplications();
          });
      } else {
        // Show mock data if API not available
        showMockApplications();
      }

      function showMockApplications() {
        var mockApps = [
          { candidateName: 'John Doe', jobTitle: 'Frontend Developer', status: 'NEW', appliedDate: 'Today' },
          { candidateName: 'Jane Smith', jobTitle: 'Backend Engineer', status: 'REVIEWING', appliedDate: 'Yesterday' }
        ];
        
        document.getElementById('applicationsCount').textContent = mockApps.length;
        document.getElementById('totalApplicantsStat').textContent = mockApps.length;
        document.getElementById('pendingReviewStat').textContent = 1;
        
        var container = document.createElement("div");
        mockApps.forEach(function(app) {
          var item = document.createElement("div");
          item.style.cssText = 'display: flex; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05);';
          item.innerHTML = `
            <div style="width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, #4facfe, #00f2fe); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
              ${app.candidateName.charAt(0)}
            </div>
            <div style="flex: 1;">
              <div style="font-weight: 500;">${app.candidateName}</div>
              <div style="font-size: 11px; color: rgba(255,255,255,0.5);">${app.jobTitle} Â· ${app.appliedDate}</div>
            </div>
            <span style="padding: 4px 8px; border-radius: 999px; font-size: 10px; background: rgba(79,172,254,0.1); color: #4facfe;">${app.status}</span>
          `;
          container.appendChild(item);
        });
        applicationsEl.innerHTML = "";
        applicationsEl.appendChild(container);
      }

      // Action functions
      window.createNewJob = function() {
        alert("Create new job post - This will open job creation form");
        // window.location.href = 'create-job.html';
      };

    });
  </script>

</body>
</html>